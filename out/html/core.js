window.game={compiled:'{"title":"proj2_test2","author":"HakoFlos","content":"","scenes":{"prevScene":{"id":"prevScene","content":{"content":"","type":"paragraph"}},"prevTopScene":{"id":"prevTopScene","content":{"content":"","type":"paragraph"}},"jumpScene":{"id":"jumpScene","content":{"content":"","type":"paragraph"}},"backSpecialScene":{"id":"backSpecialScene","content":{"content":"","type":"paragraph"}},"returnScene":{"id":"returnScene","content":{"content":"","type":"paragraph"}},"root.choice":{"id":"root.choice","newPage":false,"content":{"content":"text.","type":"paragraph"}},"root":{"id":"root","type":"scene","title":"root","newPage":true,"options":[{"id":"@root.choice","title":"choice text."}],"content":{"content":"text.","type":"paragraph"}}},"qualities":{},"qdisplays":{},"tagLookup":{}}'},function t(e,i,n){function o(a,r){if(!i[a]){if(!e[a]){var c="function"==typeof require&&require;if(!r&&c)return c(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return o(i?i:t)},h,h.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,i){!function(){"use strict";var t=function(t){if(!t)throw new Error("Assertion failed.")},i=function(t,e){for(var i=0;i<t.length;++i)e(t[i])},n=function(t,e){for(var i in t)e(i,t[i])},o=function(){for(var t={},e=0;e<arguments.length;++e){var i=arguments[e];for(var n in i)t[n]=i[n]}return t},s=function(t){var e=typeof t;return"function"===e||t&&"object"===e||!1},a=function(t){t=t.trim();var e=new Function("state","Q",t);return e.source=t,e},r=function(t,e,n){void 0!==t&&i(t,function(t){try{t.call(e,n,n.qualities)}catch(i){}})},c=function(t,e,i,n){var o=e;if(void 0===t)return o;try{o=!!t.call(i,n,n.qualities)}catch(s){}return o},u=function(t,e,i,n){var o=e;if(void 0===t)return o;try{o=t.call(i,n,n.qualities)}catch(s){}return o},h=function(t,e){var i=function(t,e){return s(e)&&void 0!==e.$code?a(e.$code):e};try{var n=JSON.parse(t,i);return e(null,n)}catch(o){return e(o)}},l=function(t){return[{type:"paragraph",content:t}]},p=function(t){return Math.floor(t)===t&&t>=0&&12>=t?["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"][t]:t.toString()},d=function(t){if(!(Math.floor(t)===t&&t>=0))return t.toString();if(12>=t)return["zeroth","first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth"][t];if(t=t.toString(),/1[0-9]$/.test(t))return t+"th";var e=t.substr(t.length-1,1);switch(e){case"1":return t+"st";case"2":return t+"nd";case"3":return t+"rd";default:return t+"th"}},g=function(t){if(Math.floor(t)!==t)return t.toString();if(t>3)return"superb+"+(t-3);if(-3>t)return"terrible"+(t+3);switch(t){case 3:return"superb";case 2:return"great";case 1:return"good";case 0:return"fair";case-1:return"mediocre";case-2:return"poor";case-3:return"terrible"}},f=function(t,e){for(var i=0;i<e.content.length;++i){var n=e.content[i],o=n.min,s=n.max;if((void 0===o||t>=o)&&(void 0===s||s>=t))return void 0!==n.output?n.output:t.toString()}return t.toString()},v=function(){};v.prototype.beginGame=function(){},v.prototype.displayContent=function(t){},v.prototype.displayChoices=function(t){},v.prototype.displayGameOver=function(){this.displayContent(l("Game Over"))},v.prototype.removeChoices=function(){},v.prototype.beginOutput=function(){},v.prototype.endOutput=function(){},v.prototype.newPage=function(){},v.prototype.setStyle=function(t){},v.prototype.signal=function(t){},v.prototype.setBg=function(t){},v.prototype.setSprites=function(t){},v.prototype.setSpriteStyle=function(t,e){},v.prototype.audio=function(t){},v.makeParentOf=function(t){t.prototype=new v,t.constructor=t};var m=function(t,e){this.ui=t,this.game=e};m.prototype.displayGameOver=function(){return this.ui.displayGameOver(),this},m.prototype.displayChoices=function(){var e=this.getCurrentChoices();return t(e),this.ui.displayChoices(e),this.state.enableTranscript&&this.transcript.push(e),this},m.prototype.displaySceneContent=function(e){var i=this.getCurrentScene();t(i);var n=i.signal||this.game.sceneSignal;if(void 0!==n&&this.ui.signal({signal:n,event:"scene-display",id:this.state.sceneId}),e?(this.ui.newPage(),this.ui.displayContent(this.state.tempCurrentContent),this.state.currentContent=this.state.tempCurrentContent.slice()):i.newPage&&(this.ui.newPage(),this.state.currentContent=[]),this.ui.setStyle(i.style),this.ui.removeChoices(),void 0!==i.content&&!e){var o=this._makeDisplayContent(i.content,!0);this.state.enableTranscript&&(this.transcript=this.transcript.concat(o)),this.state.currentContent=this.state.currentContent.concat(o),this.ui.displayContent(o)}return this._runActions(i.onDisplay),this},m.prototype.choose=function(e){var i=this.choiceCache;if(t(i),i.length<=e)throw new Error("No choice at index "+e+", only "+i.length+" choices are available.");var n=i[e];if(!n.canChoose)throw new Error("Attempted to choose index "+e+", but that choice is unavailable.");var o=n.id;return this.state.enableTranscript&&this.transcript.push("> "+n.title),delete this.choiceCache,this.goToScene(o),this},m.prototype.goToScene=function(t){this.state.sceneIdsSinceGoTo=[],this.ui.beginOutput(),this.__changeScene(t),this.ui.endOutput()},m.prototype.beginGame=function(t){this.random=t?_.fromSeeds(t):_.fromUnique(),this.state={sceneId:null,sceneIdsSinceGoTo:[],rootSceneId:this.game.rootScene||this.game.firstScene||"root",gameOver:!1,visits:{},qualities:{},currentRandomState:null,currentContent:[],tempCurrentContent:[],prevSpecialSceneId:null,prevSceneId:null,prevTopSceneId:null,jumpSceneId:null,achievements:{},bg:null,sceneStack:[],justReturned:!1,justReturnedStart:!1,justReturnedEnd:!1,sprites:{},enableTranscript:!1},this.transcript=[],this._setUpQualities(),this._loadAchievements(),this.ui.beginGame();var e=this.game.firstScene||this.state.rootSceneId;return this.goToScene(e),this},m.prototype._loadAchievements=function(){if("undefined"!=typeof localStorage&&localStorage[this.game.title+"_achievements"]){this.state.achievements=JSON.parse(localStorage[this.game.title+"_achievements"]);for(var t in this.state.achievements)this.state.qualities["achievement_"+t]=1}},m.prototype.gameOver=function(){return this.state.gameOver=!0,this.displayGameOver(),this},m.prototype.isGameOver=function(){return this.state.gameOver},m.prototype.getCurrentScene=function(){var e=this.game.scenes[this.state.sceneId];return t(void 0!==e),e},m.prototype.getCurrentChoices=function(){return this.choiceCache},m.prototype.setState=function(t){if(this.state=t,this._setUpQualities(),this.random=_.fromState(this.state.currentRandomState),this._loadAchievements(),this.isGameOver())this.displayGameOver();else{var e=this.getCurrentScene();this.choiceCache=this._compileChoices(e),this.ui.newPage(),this.ui.removeChoices(),this.ui.displayContent(this.state.currentContent),this.displayChoices(),this.ui.setSprites(this.state.sprites),this.ui.setBg(this.state.bg)}return this},m.prototype.getExportableState=function(){return this.state},m.prototype._getQDisplay=function(e,i){switch(i){case"cardinal":case"number":return p(e);case"ordinal":return d(e);case"fudge":return g(e);default:var n=this.game.qdisplays[i];return t(void 0!==n),f(e,n)}},m.prototype._evaluateStateDependencies=function(e){for(var i=[],n=0;n<e.length;++n){var o,s=e[n],a=s.fn;switch(s.type){case"insert":o=this._runExpression(a),o=s.qdisplay?this._getQDisplay(o,s.qdisplay):o.toString();break;default:t("predicate"===s.type),o=this._runPredicate(a)}void 0!==o.stateDependencies&&(o=this._makeDisplayContent(o,!1)),i.push(o)}return i},m.prototype._mergeStateEvalsInArray=function(t,e){Array.isArray(t)||(t=[t]);for(var i=[],n=0;n<t.length;++n)i=i.concat(this._mergeStateEvals(t[n],e));return i},m.prototype._mergeStateEvals=function(t,e){if(void 0===t.type)return[t];var i;switch(t.type){case"conditional":i=e[t.predicate]?this._mergeStateEvalsInArray(t.content,e):[];break;case"insert":i=e[t.insert];break;default:var n={type:t.type};n.content=this._mergeStateEvalsInArray(t.content,e),i=[n]}return i},m.prototype._makeDisplayContent=function(t,e){if(void 0===t.content)return Array.isArray(t)?t:e?[{type:"paragraph",content:t}]:[t];if(void 0===t.stateDependencies&&void 0!==t.type)return[t];var i=t.stateDependencies,n=t.content;if(i&&i.length>0){var o=this._evaluateStateDependencies(i);Array.isArray(n)||(n=[n]),n=this._mergeStateEvalsInArray(n,o)}return n},m.prototype._setUpQualities=function(){var t=this._qualitiesAccessorsPrivate={},e=this.state.qualities,i=this;n(this.game.qualities,function(n,o){var s=o.min,a=o.max,r=o.signal||i.game.qualitySignal,c=o.isValid,u=void 0!==s||void 0!==a||void 0!==r||void 0!==c;u&&(void 0!==e[n]&&(t[n]=e[n]),e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){void 0!==s&&s>e&&(e=s),void 0!==a&&e>a&&(e=a);var o=t[n];if(t[n]=e,i._runPredicate(c,!0)||(t[n]=e=o),void 0!==r&&e!==o){var u={signal:r,event:"quality-change",id:n,now:e};void 0!==o&&(u.was=o),i.ui.signal(u)}})),void 0!==o.initial&&void 0===e[n]&&(e[n]=o.initial)})},m.prototype._runActions=function(t){r(t,this,this.state)},m.prototype._runPredicate=function(t,e){return c(t,e,this,this.state)},m.prototype._runExpression=function(t,e){return u(t,e,this,this.state)},m.prototype.__changeScene=function(e){this.state.justReturned&&(this.state.justReturned=!1);var i=null,n=!1;if("prevScene"==e)null===this.prevSceneId,i=this.game.scenes[this.state.prevSceneId],e=this.state.prevSceneId,t(i);else if("prevTopScene"==e)i=this.game.scenes[this.state.prevTopSceneId],e=this.state.prevTopSceneId,t(i);else if("jumpScene"==e)i=this.game.scenes[this.state.jumpSceneId],e=this.state.jumpSceneId,t(i);else if("backSpecialScene"===e)i=this.game.scenes[this.state.prevSpecialSceneId],e=this.state.prevSpecialSceneId,n=!0,t(i),this.state.prevSpecialSceneId=null;else if("returnScene"==e){var o=this.state.sceneStack.pop();t(o),i=this.game.scenes[prevSceneId],this.state.justReturned=!0}else i=this.game.scenes[e],t(i);var s=this.state.sceneId;if(s){this.state.prevSceneId=s,i.isTop&&(this.state.prevTopSceneId=s),i.isSpecial&&null===this.state.prevSpecialSceneId&&(this.state.tempCurrentContent=this.state.currentContent.slice(),this.state.prevSpecialSceneId=s);var a=this.getCurrentScene();this._runActions(a.onDeparture);var r=a.signal||this.game.sceneSignal;void 0!==r&&this.ui.signal({signal:r,event:"scene-departure",id:this.state.sceneId,to:e})}this.state.sceneId=e,this.state.sceneIdsSinceGoTo.push(e),i.setRoot&&(this.state.rootSceneId=e),i.setJump&&(this.state.jumpSceneId=i.setJump),void 0!==i.countVisitsMax&&(void 0===this.state.visits[e]?this.state.visits[e]=1:this.state.visits[e]<i.countVisitsMax&&this.state.visits[e]++),n||this.state.justReturned||this._runActions(i.onArrival);var c=i.signal||this.game.sceneSignal;if(void 0!==c){var u={signal:c,event:"scene-arrival",id:e};s&&(u.from=s),this.ui.signal(u)}this.state.currentRandomState=this.random.getState(),this.displaySceneContent(n),i.setBg&&(this.state.bg=i.setBg,this.ui.setBg(i.setBg)),i.setSprites&&(this.state.sprites=i.setSprites,this.ui.setSprites(i.setSprites)),i.audio&&this.ui.audio(i.audio),i.setTopLeftStyle&&this.ui.setSpriteStyle("topLeft",i.setTopLeftStyle),i.setTopRightStyle&&this.ui.setSpriteStyle("topRight",i.setTopRightStyle),i.setBottomLeftStyle&&this.ui.setSpriteStyle("bottomLeft",i.setBottomLeftStyle),i.setBottomRightStyle&&this.ui.setSpriteStyle("bottomRight",i.setBottomRightStyle),i.achievement&&(this.state.achievements[i.achievement]=1,this.state.qualities["achievement_"+i.achievement]=1,"undefined"!=typeof localStorage&&(localStorage[this.game.title+"_achievements"]=JSON.stringify(this.state.achievements)));var h=!1;if(i.gameOver===!0)h=!0,this.gameOver();else if(i.goSubEnd&&!this.state.justReturnedEnd)for(var l=[],p=0;p<i.goSub.length;++p){var d=i.goSub[p];(void 0===d.predicate||this._runPredicate(d.predicate))&&l.push(d.id)}else if(i.goTo){for(var g=[],f=0;f<i.goTo.length;++f){var v=i.goTo[f];(void 0===v.predicate||this._runPredicate(v.predicate))&&g.push(v.id)}if(1===g.length)h=!0,this.__changeScene(g[0]);else if(g.length>1){var m=this.random.uint32(),_=m%g.length,y=g[_];h=!0,this.__changeScene(y)}}else if(i.goToRef){for(var S=[],b=0;b<i.goToRef.length;++b){var w=i.goToRef[b];(void 0===w.predicate||this._runPredicate(w.predicate))&&S.push(w.id)}if(1===S.length)h=!0,this.__changeScene(this.state.qualities[S[0]]);else if(S.length>1){var C=this.random.uint32()%S.length,I=S[C];h=!0,this.__changeScene(this.state.qualities[I])}}h||(this.choiceCache=this._compileChoices(i),null===this.choiceCache?i.gameOver!==!1&&this.gameOver():this.displayChoices())},m.prototype.__getChoiceSelectionData=function(t){var e=[];for(var i in t){var n=this.game.scenes[i],o=t[i];o.order=o.order||n.order||0,o.priority=o.priority||n.priority||1,void 0===o.frequency&&(o.frequency=n.frequency,void 0===o.frequency&&(o.frequency=100)),o.selectionPriority=0,e.push(o)}return e},m.prototype.__filterViewable=function(t){var e={};for(var i in t){var n=this.game.scenes[i],o=n.maxVisits;if(void 0!==o){var s=this.state.visits[i]||0;if(s>=o)continue}var a=this._runPredicate(n.viewIf,!0);a&&(e[i]=t[i])}return e},m.prototype.__getChoiceIdsFromOptions=function(e){var s=this,a={};return i(e,function(e){if(s._runPredicate(e.viewIf,!0))if("@"===e.id.substr(0,1)){var i=e.id.substring(1),r=o(e,{id:i});a[i]=r}else{t("#"===e.id.substr(0,1));var c=s.game.tagLookup[e.id.substring(1)];n(c,function(t){void 0===a[t]&&(a[t]=o(e,{id:t}))})}}),a},m.prototype.__filterByPriority=function(e,n,o){t(null===n||null===o||o>=n);var s,a=this,r=[],c=[];e.sort(function(t,e){return e.priority-t.priority});for(var u,h=0;h<e.length;++h){if(s=e[h],s.priority!==u){if(void 0!==u&&(null===n||h>=n))break;r.push.apply(r,c),c=[],u=s.priority}c.push(s)}var l=r.length,p=l+c.length;if(null===o||o>=p)r.push.apply(r,c);else{i(c,function(t){null===t.frequency?t.selectionPriority=0:t.selectionPriority=a.random.random()/t.frequency}),c.sort(function(t,e){return t.selectionPriority-e.selectionPriority});var d=o-l,g=c.slice(0,d);r.push.apply(r,g)}return r},m.prototype.__getChoiceDisplayData=function(e){for(var i=[],n=0,o=0;o<e.length;++o){var s=e[o],a=this.game.scenes[s.id],r=!0;s.chooseIf&&(r=this._runPredicate(s.chooseIf,!0)),r&&a.chooseIf&&(r=this._runPredicate(a.chooseIf,!0));var c=s.title||a.title;t(c);var u=null;r||(u=s.unavailableSubtitle||a.unavailableSubtitle),u||(u=s.subtitle||a.subtitle);var h={id:s.id,canChoose:r,title:this._makeDisplayContent(c,!1)};u&&(h.subtitle=this._makeDisplayContent(u,!1)),i.push(h),r&&++n}return{choices:i,numChoosable:n}},m.prototype._compileChoices=function(e){t(e);var i=e.options,n=[],o=0;if(void 0!==i){var s=this.__getChoiceIdsFromOptions(i);s=this.__filterViewable(s);var a=this.__getChoiceSelectionData(s),r=e.minChoices||null,c=e.maxChoices||null;a=this.__filterByPriority(a,r,c),a.sort(function(t,e){return t.order-e.order});var u=this.__getChoiceDisplayData(a);n=u.choices,o=u.numChoosable}if(0===o){var h=this.state.rootSceneId;if(h!==this.state.sceneId){var l=this.game.scenes[h].chooseIf;(!l||this._runPredicate(l,!0))&&(n.push({id:h,title:"Continue...",canChoose:!0}),++o)}}return o>0?n:null};var _=function(t,e,i,n,o){this.getState=function(){return[t,e,i,n,o]};var s=function(t,e){var i=t>>16&65535,n=65535&t,o=e>>16&65535,s=65535&e,a=i*s+n*o&65535;return(a<<16>>>0)+n*s};this.uint32=function(){var a=(i^i>>>7)>>>0;return i=n,n=o,o=e,e=t,t=t^t<<6^(a^a<<13)>>>0,s(n+n+1,t)>>>0},this.random=function(){return 2.3283064365386963e-10*this.uint32()}},y=1;_.fromUnique=function(){var t=(new Date).getTime();return _.fromSeeds([t,y++])},_.fromTime=function(){return _.fromSeeds([(new Date).getTime()])},_.fromSeeds=function(t){for(var e=886756453,i=88675123,n=123456789,o=362436069,s=521288629,a=function(t){t=t.toString();for(var e=4022871197,i=0;i<t.length;i++){e+=t.charCodeAt(i);var n=.02519603282416938*e;e=n>>>0,n-=e,n*=e,e=n>>>0,n-=e,e+=4294967296*n}return 2.3283064365386963e-10*(e>>>0)},r=0;r<t.length;r++){var c=4294967296*a(t[r]);e^=c,i^=c,n^=c,o^=c,s^=c}return new _(e,i,n,o,s)},_.fromState=function(t){return new _(t[0],t[1],t[2],t[3],t[4])},e.exports={makeFunctionFromSource:a,runActions:r,runPredicate:c,runExpression:u,convertJSONToGame:h,simpleContent:l,getCardinalNumber:p,getOrdinalNumber:d,getUserQDisplay:f,getFudgeDisplay:g,DendryEngine:m,UserInterface:v,NullUserInterface:v,Random:_}}()},{}],2:[function(t,e,i){!function(e){"use strict";var i=t("./content/html"),n=t("../engine"),o=function(t,e){this.game=t,this.$content=e,this._registerEvents(),this.dendryEngine=new n.DendryEngine(this,t),this.hasSidebar=!1,this.sidebarQualities=[],this.base_settings={disable_bg:!1,animate:!1,animate_bg:!0,disable_audio:!1,show_portraits:!0},this.disable_bg=!1,this.animate=!1,this.animate_bg=!0,this.disable_audio=!1,this.show_portraits=!0,this.fade_time=600,this.bg_fade_out_time=200,this.bg_fade_in_time=1e3,this.sound_fade_time=2e3,this.contentToHTML=i,this.spriteLocs={topLeft:1,topRight:1,bottomLeft:1,bottomRight:1},this.currentAudio=null,this.currentAudioURL="",this.audioQueue=[],this.onNewPage=!1,this.save_prefix=t.title+"_"+t.author+"_save",this.max_slots=8,this.DateOptions={hour:"numeric",minute:"numeric",second:"numeric",year:"numeric",month:"short",day:"numeric"}};n.UserInterface.makeParentOf(o),o.prototype.displayContent=function(t){var n=e(i.convert(t));this.animate?(n.fadeIn(this.fade_time),this.$content.append(n)):this.$content.append(n),n.focus(),window&&window.onDisplayContent&&window.onDisplayContent()},o.prototype.displayGameOver=function(){var t=e("<p>").text(this.getGameOverMsg()).addClass("game-over");this.animate?(t.fadeIn(this.fade_time),this.$content.append(t)):this.$content.append(t),t.focus()},o.prototype.displayChoices=function(t){for(var n=e("<ul>").addClass("choices"),o=0;o<t.length;++o){var s=t[o],a=i.convertLine(s.title),r="";void 0!==s.subtitle&&(r=i.convertLine(s.subtitle));var c=e("<li>"),u=c;s.canChoose?(u=e("<a>").attr({href:"#","data-choice":o}),c.html(u)):u.addClass("unavailable"),u.html(a),r&&c.append(e("<div>").addClass("subtitle").html(r)),n.append(c)}this.animate?(n.fadeIn(this.fade_time),this.$content.append(n)):this.$content.append(n),n.focus(),this.onNewPage&&(this.onNewPage=!1,window&&window.onNewPage&&window.onNewPage())},o.prototype.newPage=function(){if(this.animate){this.$content;this.$content.empty(),this.$content.children().fadeOut(this.fade_time,function(){})}else this.$content.empty();this.onNewPage=!0},o.prototype.setStyle=function(t){this.$content.removeClass(),void 0!==t&&this.$content.addClass(t)},o.prototype.removeChoices=function(){e(".choices",this.$content).remove(),e(".hidden",this.$content).remove()},o.prototype.beginOutput=function(){e("#read-marker",this.$content).remove(),this.$content.append(e("<hr>").attr("id","read-marker"))},o.prototype.endOutput=function(){var t=e("#read-marker");this.animate&&(t.length>0?e("html, body").animate({scrollTop:t.offset().top},this.fade_time):e("html, body").animate({scrollTop:0},this.fade_time))},o.prototype.signal=function(t){console.log(t);var e=t.signal,i=t.event,n=t.id;window&&window.handleSignal&&window.handleSignal(e,i,n)},o.prototype.setBg=function(t){this.disable_bg?(e("#bg1").addClass("content_hidden"),e("#bg1").removeClass("content_visible"),e("#bg1").css("background-image","none")):t&&"none"!=t&&"null"!=t?t.startsWith("#")||t.startsWith("rgba(")||t.startsWith("rgb(")?this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,function(){e("#bg1").css("background-image","none"),e("#bg1").css("background-color",t)}),e("#bg1").fadeIn(this.bg_fade_in_time,function(){e("#bg2").css("background-image","none")}),console.log("changing background color "+t)):(e("#bg1").css("background-image","none"),e("#bg1").css("bacground-color",t)):t.startsWith("linear-gradient(")?this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,function(){e("#bg1").css("background-image",t)}),e("#bg1").fadeIn(this.bg_fade_in_time,function(){e("#bg2").css("background-image",t)}),console.log("changing background gradient "+t)):e("#bg1").css("background-image",t):this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,function(){e("#bg1").css("background-image",'url("'+t+'")')}),e("#bg1").fadeIn(this.bg_fade_in_time,function(){e("#bg2").css("background-image",e("#bg1").css("background-image"))})):e("#bg1").css("background-image",'url("'+t+'")'):this.animate_bg?(e("#bg1").addClass("content_hidden"),e("#bg1").removeClass("content_visible"),setTimeout(function(){e("#bg1").css("background-image","none"),e("#bg1").removeClass("content_hidden"),e("#bg1").addClass("content_visible")},100)):e("#bg1").css("background-image","none")},o.prototype.setSprites=function(t){if(window&&window.setSprites)return void window.setSprites(t);if(!this.show_portraits||"none"==t||"clear"==t)return e("#topLeftSprite").children().fadeOut(this.fade_time,function(){e("#topLeftSprite").empty()}),e("#topRightSprite").children().fadeOut(this.fade_time,function(){e("#topRightSprite").empty()}),e("#bottomLeftSprite").children().fadeOut(this.fade_time,function(){e("#bottomLeftSprite").empty()}),void e("#bottomRightSprite").children().fadeOut(this.fade_time,function(){e("#bottomRightSprite").empty()});if(t instanceof Array)for(var i=0;i<t.length;i++){var n=t[i][0],o=t[i][1];this.setSprite(n,o)}else if(t)for(var s in Object.keys(t))sprites.push([s,t[s]])},o.prototype.setSprite=function(t,i){if(this.show_portraits){if(window&&window.setSprite)return void window.setSprite(t,i);t=t.toLowerCase();var n;return"topleft"==t?n=e("#topLeftSprite"):"topright"==t?n=e("#topRightSprite"):"bottomleft"==t?n=e("#bottomLeftSprite"):"bottomright"==t&&(n=e("#bottomRightSprite")),"none"==i||"clear"==i?(delete this.dendryEngine.state.sprites[t],void n.fadeOut(this.fade_time,function(){n.empty()})):(this.dendryEngine.state.sprites[t]=i,void n.fadeOut(this.fade_time,function(){n.emtpy();var t=new Image;t.src=i,n.append(t),console.log("fadeIn"),n.fadeIn(this.fade_time)}))}},o.prototype.setSpriteStyle=function(t,i){if(window&&window.setSpriteStyle)return void window.setSpriteStyle(t,i);var n;if("topleft"==t)n=e("#topLeftSprite");else if("topright"==t)n=e("#topRightSprite");else if("bottomleft"==t)n=e("#bottomLeftSprite");else{if("bottomright"!=t)return;n=e("#bottomRightSprite")}n.css(i)},o.prototype.audio=function(t){if(this.disable_audio)return void(this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.loop=!1));var i=t.split(" "),n=i.includes("loop"),o=i.includes("queue"),s=i.includes("nofade"),a=i[0],r=this.currentAudio,c=this.sound_fade_time;if("null"==a||"none"==a)this.currentAudio&&(e(r).animate({volume:0},this.sound_fade_time,function(){r.pause()}),this.currentAudio.loop=!1);else{if(console.log("new audio:",a,"current audio:",this.currentAudioURL),this.currentAudio&&(this.currentAudioURL==a||o))if(r.ended||r.paused)this.currentAudioURL=a,r.src=a,console.log("Fading in new audio"),r.volume=0,r.play(),e(r).animate({volume:1},c);else{console.log("adding music to queue"),this.audioQueue=[a];var u=this.audioQueue;this.currentAudio.onended=function(){var t=u.pop();t&&(r.src=t,console.log("playing from queue"),r.play(),e(r).animate({volume:1},c),window.dendryUI.currentAudioURL=t)}}else this.currentAudio?(this.currentAudioURL=a,console.log("currentAudio present,  fading out current audio"),r.onended=function(){},s?(r.pause(),r.src=a,r.play()):e(r).animate({volume:0},this.sound_fade_time,function(){console.log(r),r.src=a,console.log("Fading in new audio"),r.play(),e(r).animate({volume:1},c)})):(this.currentAudio=new Audio(a),this.currentAudio.volume=0,this.currentAudio.play(),e(this.currentAudio).animate({volume:1},this.sound_fade_time));n?this.currentAudio.loop=!0:this.currentAudio.loop=!1}},o.prototype.saveSettings=function(){"undefined"!=typeof localStorage&&(localStorage[this.game.title+"_animate"]=this.animate,localStorage[this.game.title+"_disable_bg"]=this.disable_bg,localStorage[this.game.title+"_animate_bg"]=this.animate_bg,localStorage[this.game.title+"_show_portraits"]=this.show_portraits,localStorage[this.game.title+"_disable_audio"]=this.disable_audio)},o.prototype.loadSettings=function(t){"undefined"!=typeof localStorage&&(localStorage[this.game.title+"_animate"]?this.animate="false"!=localStorage[this.game.title+"_animate"]||!1:t&&t.animate?this.animate=t.animate:this.animate=!1,localStorage[this.game.title+"_disable_bg"]?this.disable_bg="false"!=localStorage[this.game.title+"_disable_bg"]||!1:t&&t.disable_bg?this.disable_bg=t.disable_bg:this.disable_bg=!1,localStorage[this.game.title+"_animate_bg"]?this.animate_bg="false"!=localStorage[this.game.title+"_animate_bg"]||!1:t&&t.animate_bg?this.animate_bg=t.animate_bg:this.animate_bg=!0,localStorage[this.game.title+"_show_portraits"]?this.show_portraits="false"!=localStorage[this.game.title+"_show_portraits"]||!1:t&&t.show_portraits?this.show_portraits=t.show_portraits:this.show_portraits=!0,localStorage[this.game.title+"_disable_audio"]?this.disable_audio="false"!=localStorage[this.game.title+"_disable_audio"]||!1:t&&t.disable_audio?this.disable_audio=t.disable_audio:this.disable_audio=!1)},o.prototype.toggle_audio=function(t){t?this.disable_audio=!1:(this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.loop=!1),this.disable_audio=!0)},o.prototype.autosave=function(){var t=localStorage[this.save_prefix+"_a0"];t&&(localStorage[this.save_prefix+"_a1"]=t,localStorage[this.save_prefix+"_timestamp_a1"]=localStorage[this.save_prefix+"_timestamp_a0"]);var e="a0",i=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_"+e]=i;var n=this.dendryEngine.state.sceneId,o=new Date(Date.now());o=n+"\n("+o.toLocaleString(void 0,this.DateOptions)+")",localStorage[this.save_prefix+"_timestamp_"+e]=o,this.populateSaveSlots(e+1,2)},o.prototype.quickSave=function(){var t=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_q"]=t,window.alert("Saved.")},o.prototype.saveSlot=function(t){var e=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_"+t]=e;var i=this.dendryEngine.state.sceneId,n=new Date(Date.now());n=i+"\n("+n.toLocaleString(void 0,this.DateOptions)+")",localStorage[this.save_prefix+"_timestamp_"+t]=n,this.populateSaveSlots(t+1,2)},o.prototype.quickLoad=function(){if(localStorage[this.save_prefix+"_q"]){var t=localStorage[this.save_prefix+"_q"];this.dendryEngine.setState(JSON.parse(t)),window.alert("Loaded.")}else window.alert("No save available.")},o.prototype.loadSlot=function(t){if(localStorage[this.save_prefix+"_"+t]){var e=localStorage[this.save_prefix+"_"+t];this.dendryEngine.setState(JSON.parse(e)),this.hideSaveSlots(),window.alert("Loaded.")}else window.alert("No save available.")},o.prototype.deleteSlot=function(t){localStorage[this.save_prefix+"_"+t]?(localStorage[this.save_prefix+"_"+t]="",localStorage[this.save_prefix+"_timestamp_"+t]="",this.populateSaveSlots(t+1,2)):window.alert("No save available.")},o.prototype.populateSaveSlots=function(t,e){function i(t){return function(e){a.loadSlot(t)}}function n(t){return function(e){a.saveSlot(t)}}function o(t){return function(e){a.deleteSlot(t)}}function s(t){var e=document.getElementById("save_info_"+t),s=document.getElementById("save_button_"+t),r=document.getElementById("delete_button_"+t);if(localStorage[a.save_prefix+"_"+t]){var c=localStorage[a.save_prefix+"_timestamp_"+t];e.textContent=c,s.textContent="Load",s.onclick=i(t),r.onclick=o(t)}else s.textContent="Save",e.textContent="Empty",s.onclick=n(t)}for(var a=this,r=0;t>r;r++)s(r);for(r=0;e>r;r++)s("a"+r)},o.prototype.showSaveSlots=function(){var t=document.getElementById("save");t.style.display="block",this.populateSaveSlots(this.max_slots,2);var e=this;t.onclick||(t.onclick=function(t){var i=t.target,n=document.getElementById("save");i==n&&e.hideSaveSlots()})},o.prototype.hideSaveSlots=function(){var t=document.getElementById("save");t.style.display="none"},o.prototype.setOption=function(t,e){this[t]=e,this.saveSettings()},o.prototype.populateOptions=function(){var t=this.disable_bg,i=this.animate,n=this.animate_bg;t?e("#backgrounds_no")[0].checked=!0:e("#backgrounds_yes")[0].checked=!0,i?e("#animate_yes")[0].checked=!0:e("#animate_no")[0].checked=!0,n?e("#animate_bg_yes")[0].checked=!0:e("#animate_bg_no")[0].checked=!0},o.prototype.showOptions=function(){var t=document.getElementById("options");this.populateOptions(),t.style.display="block",t.onclick||(t.onclick=function(t){var e=t.target,i=document.getElementById("options");e==i&&this.hideOptions()})},o.prototype.getGameOverMsg=function(){return"Game Over (reload to read again)"},o.prototype._registerEvents=function(){var t=this;this.$content.on("click","ul.choices li a",function(i){i.preventDefault(),i.stopPropagation();var n=parseInt(e(this).attr("data-choice"));return t.dendryEngine.choose(n),!1}),this.$content.on("click","ul.choices li",function(t){return t.preventDefault(),t.stopPropagation(),e("a",this).click(),!1})};var s=function(){n.convertJSONToGame(window.game.compiled,function(t,i){if(t)throw t;var n=new o(i,e("#content"));if(window.dendryUI=n,void 0!==window.dendryModifyUI){var s=window.dendryModifyUI(n);if(s)return}n.dendryEngine.beginGame()})};e(s)}(jQuery)},{"../engine":1,"./content/html":3}],3:[function(t,e,i){!function(){"use strict";var t=function(t){if(void 0===t.type)return"undefined"!=typeof window&&window.displayText&&(t=window.displayText(t)),t;switch(t.type){case"emphasis-1":return"<em>"+i(t.content)+"</em>";case"emphasis-2":return"<strong>"+i(t.content)+"</strong>";case"emphasis-3":return"<code>"+i(t.content)+"</code>";case"hidden":return'<span class="hidden">'+i(t.content)+"</span>";case"line-break":return"<br>";case"magic":return t.content;case"insert":case"conditional":throw new Error(t.type+" should have been evaluated by now.")}},i=function(e){if(Array.isArray(e)){for(var i=[],n=0;n<e.length;++n){var o=e[n];i.push(t(o))}return i.join("")}return t(e)},n=function(t){for(var e=[],n=0;n<t.length;++n){var o=t[n];switch(o.type){case"heading":e.push("<h1>"),e.push(i(o.content)),e.push("</h1>");break;case"paragraph":e.push("<p>"),e.push(i(o.content)),e.push("</p>");break;case"quotation":e.push("<blockquote>"),e.push(i(o.content)),e.push("</blockquote>");break;case"attribution":e.push('<blockquote class="attribution">'),e.push(i(o.content)),e.push("</blockquote>");break;case"magic":e.push(o.content);break;case"hrule":e.push("<hr>")}}return e.join("")};e.exports={convert:n,convertLine:i}}()},{}]},{},[2]);